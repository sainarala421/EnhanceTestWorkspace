#!/usr/bin/env groovy
/*
 * This Jenkinsfile is intended to run on https://ci.jenkins.io and may fail anywhere else.
 * It makes assumptions about plugins being installed, labels mapping to nodes that can build what is needed, etc.
 *
 * The required labels are "java" and "docker" - "java" would be any node that can run Java builds. It doesn't need
 * to have Java installed, but some setups may have nodes that shouldn't have heavier builds running on them, so we
 * make this explicit. "docker" would be any node with docker installed.
 */

 pipeline {
    agent {
        label 'master'
    }
    /* environment {
        ADMIN_USER = credentials('admin-user')
    } */
    stages {
        stage ("Stage 1") {
            steps {
                echo 'stage 1'
            }
        }
        stage ("Stage 2") {
            steps {
                echo 'stage 2'
            }
        }
        stage ("Stage 3") {
            steps {
                sh 'python --version'
                sh 'whoami'
                sh 'sw_vers'
                sh 'pwd'
                sh 'ls -l'
            }
        }
        /* stage ("stage5 Create Virtualenv") {
            steps {
                sh 'virtualenv test_env'
                sh 'source test_env/bin/activate'
            }
        } */
        /* stage ("Stage 6 Checkout repo") {
            steps {
                git 'https://github.com/enhanceTAfrancis/EnhanceTestWorkspace.git'
                sh 'ls -l'
            }
        } */
        /* stage ("Stage 7 install requirements") {
            steps {
                sh 'ls -l'
                sh 'sudo pip install -e .'
            }
        } */
        stage ("Stage 8: Run robot tests") {
            environment {
                PATH        = "${PATH}:/usr/local/bin/chromedriver"
                AWS_ENABLED = 0
            }
            steps {
                sh 'ls -l'
                sh 'pwd'
                echo 'Stage 8 robot start'
                // sh 'pybot --version'
                sh 'cd EnhanceWorkspace/Mercury'
                sh 'pwd'
                sh 'ls -l'
                sh 'pybot --argumentfile argument_file.txt -i MERCURY .'
                echo 'Stage 8 robot end'

            }
        }
    }
    post {
        always {
            echo "Send notifications for result: ${currentBuild.result}"
            mail to:"agundayfrancis@gmail.com",
                subject:"STATUS FOR PROJECT: ${currentBuild.fullDisplayName}",
                body: "RESULT: ${currentBuild.result}"
            step([
              $class: 'RobotPublisher',
              outputPath: '.',
              passThreshold: 0,
              unstableThreshold: 0,
              otherFiles: "**/*.png"
            ]) 
        }
    }

 }
